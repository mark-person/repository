
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<title></title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1,user-scalable=no">

<link th:replace="common/fragment::mobile" />
<script th:src="@{/static/mobile/swiper.jquery.min.js}" type="text/javascript"></script>
<script th:src="@{/static/markdown/marked.min.js}" type="text/javascript"></script>
<link th:href="@{/static/mobile/swiper.min.css}" rel="stylesheet">

<script type="text/javascript" th:inline="javascript">
var controllerPath = contextPath + "auto/mobile/";

$(function() {
	
	var uspList = [[${uspList}]];
	var title = $("#kTitleHidden").html();
	for (i in uspList) {
		title = title.replace(new RegExp("\\$\\{" + uspList[i].uspId + "\\}", "g"), '<a href="/auto/mobile/listByUsp?uspId=' + uspList[i].uspId + '">' + uspList[i].key + '</a>');
	}
	$("#kTitle").html(title);

	var swiper = new Swiper('.swiper-container', {
		pagination: '.swiper-pagination'
	});
	
	var kContent = $("#kContentHidden").html();
	if (kContent) {
		var html = marked(kContent);
		$('#kContent').contents().find('body').html(html);
		$('#kContent').contents().find('body').css("font-size", "0.825rem");
	}
	else {
		$('#kContent').parent().hide();
	}
});

function edit() {
	var kId = [[${pojo.kId}]];
	location.href = [[@{/auto/mobile/edit}]] + "?id=" + kId;
}

var isFavorite = [[${isFavorite}]];
function favorite() {
	var uri = isFavorite ? "cancelFavorite" : "confirmFavorite";
	var msg = isFavorite ? "取消收藏成功" : "收藏成功";
	showLoading();
	$.post(controllerPath + uri, "kId=[[${pojo.kId}]]", function(r) {
		hideLoading();
		if (r.errcode === 0) {
			$("#favoriteButton").removeClass("icon-shoucang");
			$("#favoriteButton").removeClass("icon-shoucang1");
			if (isFavorite) {
				$("#favoriteButton").addClass("icon-shoucang");
			}
			else {
				$("#favoriteButton").addClass("icon-shoucang1");
			}
			
			isFavorite = isFavorite ? false : true;
			alertSuccess(msg);
		}
	});
}

var isImgInit = true; 
function showImg() {
	
	$(".viewImgClass").each(function(i, o) {
		var img = o;
		if (isImgInit) {
			$(".list-group,#backDiv").hide();
			
			$(document.body).css("background-color", "black");
			$(".swiper-slide").css("background-color", "black");
			
			$("#bottomDiv").hide();
			
			$(".swiper-container").css({position:"fixed", top:0})
			
			
			
			$(".swiper-container").css("width", $(".swiper-slide").css("width"));
			$(".swiper-wrapper").css("width", $(".swiper-slide").css("width"));
			
			
			$(".swiper-container").css("height", $(window).height());
			
			var initWidth = new Number($(img).data("data-init-width"));
			var initHeight = new Number($(img).data("data-init-height"));
			
			if (initWidth/initHeight > $(document.body).width()/$(window).height()) {
				$(img).css("width", $(document.body).width());
				$(img).css("height", $(document.body).width()*initHeight/initWidth);
			}
			else {
				$(img).css("width",  $(window).height()*initWidth/initHeight);
				$(img).css("height", $(window).height());
			}
		}
		else {
			$(".list-group,#backDiv").show();
			$(document.body).css("background-color", "white");
			$(".swiper-slide").css("background-color", "white");
			$("#bottomDiv").show();
			$(".swiper-container").css({position:""})
			// 还原
			$(".swiper-container").css("height", "25rem");
			
			var initWidth = new Number($(img).data("data-init-width"));
			var initHeight = new Number($(img).data("data-init-height"));
			
			if (initWidth > initHeight) {
				$(img).css("width", $(document.body).width());
				$(img).css("height", $(document.body).width()*initHeight/initWidth);
			}
			else {
				$(img).css("width", 25*initWidth/initHeight + "rem");
				$(img).css("height", "25rem");
			}
		}	
	})
	
	
	isImgInit = isImgInit ? false : true;
}

imgOnload = function(img) {
	var initWidth = img.width;
	var initHeight = img.height;
	$(img).data("data-init-width", initWidth);
	$(img).data("data-init-height", initHeight);
	
}

</script>
<style type="text/css">
.swiper-container {
	height: 25rem;
	width: 100%;
	margin: 0;
}



.swiper-slide {

	text-align: center;
	font-size: 18px;
	background: #fff;
	/* Center slide text vertically */
	display: -webkit-box;
	display: -ms-flexbox;
	display: -webkit-flex;
	display: flex;
	-webkit-box-pack: center;
	-ms-flex-pack: center;
	-webkit-justify-content: center;
	justify-content: center;
	-webkit-box-align: center;
	-ms-flex-align: center;
	-webkit-align-items: center;
	align-items: center;
	border: 1px solid rgba(0,0,0,.125);
}
.list-group-item {
	padding-left:1.7rem;padding-right:1.7rem;
}
.icon-shoucang1 {
	color:red;
}
</style>
</head>
<body>

<script>
function back() {
	if (document.referrer.indexOf("edit") > 0) {
		location.href = localStorage.getItem("lastViewReferrer");
	}
	else {
		history.go(-1);
	}
}

$(function() {
	if (document.referrer.indexOf("edit") == -1) {
		localStorage.setItem("lastViewReferrer", document.referrer);
	}
})
</script>


<div class="container" style="padding:0px">
	
	<div style="position:fixed; z-index:99999999;opacity:0.5;margin-top:-0.2rem;margin-left:0.9rem;" id="backDiv">
		<div onclick="back();" style=""><span style="font-size: 2.2rem;" class="iconfont icon-fanhui5"></span></div>
	</div>

	<div class="panel panel-default">
		<div class="swiper-container">
			<div class="swiper-wrapper">
				<div class="swiper-slide" th:each="item,iterStat:${imgList}">
					<img class="viewImgClass" th:src="'/img/' + ${item}" style="max-width: 100%; max-height: 100%;" onclick="showImg(this)" onload="imgOnload(this)">
				</div>
			</div>
			<div class="swiper-pagination" id="view-swiper-pagination2"></div>
		</div>
		<ul class="list-group" >
			<li class="list-group-item" style="border-top:none;">
				<div th:text="${pojo.kTitle}" id="kTitleHidden" style="display:none;"></div>
				<div class="row" id="kTitle">&nbsp;</div>
			</li>
			<li class="list-group-item">
				<div class="row" style="display: flex; justify-content: space-between;" >
					<div th:text="${pojo.catName}"></div>
					<div id="recommend" style="display: flex; justify-content: space-between;">
						<span class="star" th:each="item:${starList}">⭐</span>
					</div>
				</div>
			</li>
			<li class="list-group-item" style="padding: 0.265rem; margin-bottom: 2rem;">
				<div th:text="${pojo.kContent}" id="kContentHidden" style="display:none;"></div>
				<iframe id="kContent" style="border: 0; width: 100%;"></iframe>
			</li>
		</ul>
	</div>
</div>

<div id="bottomDiv" style="position: fixed; bottom: 0; width: 25.875rem; background-color: #f0f0f0;z-index:9999">
	<div style="padding: 0.2rem; display: flex; justify-content: space-around;align-items:center;" >
		<div th:if="${action!='readonly'}">
			<a style="background-color: orange;color:white;padding:0.4rem 2.8rem;border-radius: 0.865rem;cursor: pointer;" onclick="edit()">修改</a>
		</div>
		<div style="text-align: center;cursor: pointer;" onclick="favorite()">
			<div class="iconfont icon-shoucang" id="favoriteButton" th:if="${!isFavorite}"></div>
			<div class="iconfont icon-shoucang1" id="favoriteButton" th:if="${isFavorite}"></div>
			<div style="font-size:0.6rem">收藏</div>
		</div>
	</div>
</div>

</body>
</html>




